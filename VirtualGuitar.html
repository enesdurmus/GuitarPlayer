<!doctype html>
<html>

<head>

  <title>GuitarPlayer</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="32x32"
    href="https://enesdurmus.github.io/GuitarPlayer/Images/VirtualGuitarIcon.png">
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>
  <script src="defaultSongs.js" defer></script>

</head>
<style>
  body {
    background-color: #222831;
  }

  div.Conteiner {
    width: inherit;
    height: inherit;
  }

  div.GuitarBackground {
    display: block;
    background-color: #eeeeee;
    background-size: contain;
    margin-left: auto;
    margin-right: auto;
    width: 380px;
    height: 225px;
  }

  div.ButtonsContainer {
    display: flex;
    margin-left: auto;
    margin-right: auto;
  }

  div.ComboBoxContainer {
    display: flex;
    margin-left: auto;
    margin-right: auto;
    margin-top: 20px;
  }

  label.ComboBoxLabel {
    font-size: 22px;
    background-color: #c5a880;
    color: #0f0f0f;
    font-family: 'Gill Sans MT';
    margin-left: auto;
    margin-right: auto;
    font-style: italic;
    text-align: center;
  }

  select.ComboBox {
    font-size: 22px;
    background-color: #c5a880;
    color: #0f0f0f;
    font-family: 'Gill Sans MT';
    margin-left: 5px;
    margin-right: auto;
    font-style: italic;
    text-align: center;
  }

  ul.guitarNeck {
    margin-block-start: 0;
    justify-content: space-between;
    display: flex;
    width: 100%;
    height: 100%;
    padding-left: 1px;
  }

  li.GuitarNeck-ul-li {
    display: flex;
    border-right: 2px solid #8f8f8f;
    flex-direction: column;
    width: 30px;
    height: 225px;
  }

  ul.firstFret {
    display: block;
    width: 100%;
    height: 100%;
    padding-inline-start: 0;
  }

  li.firstFret-ul-li {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 38px;
    margin: 0;
    padding: 0;
    border: 0;
    color: #0f0f0f;
    font-size: 15px;
    font-style: italic;
    font-family: 'Gill Sans MT';
  }

  ul li::marker {
    font-size: 0;
  }

  ul.Strings {
    display: block;
    position: absolute;
    width: 360px;
    height: 225px;
    padding-inline-start: 14px;
  }

  li.String-li {
    display: block;
    width: 100%;
    height: 38px;
  }

  span.string {
    display: flex;
    z-index: 1;
    height: 4px;
    width: 100%;
    position: relative;
    top: 17px;
    box-shadow: 0.04em 0.37em 0.02em 0 rgba(0, 0, 0, .1);
    background-image: repeating-linear-gradient(50deg, rgba(0, 0, 0, .6), transparent .15em, transparent .2em),
      linear-gradient(180deg, rgba(0, 0, 0, .1) 10%, hsla(0, 0%, 100%, .25) 15%, hsla(0, 0%, 100%, .8) 30%,
        hsla(0, 0%, 100%, .25) 45%, rgba(0, 0, 0, .6) 90%);
    margin-left: 3px;
  }

  span.stringTremble {
    display: flex;
    z-index: 1;
    height: 4px;
    width: 0%;
    position: relative;
    top: 17px;
    box-shadow: 0.04em 0.37em 0.02em 0 rgba(0, 0, 0, .1);
    background-image: repeating-linear-gradient(50deg, rgba(0, 0, 0, .6), transparent .15em, transparent .2em),
      linear-gradient(180deg, rgba(0, 0, 0, .1) 10%, hsla(0, 0%, 100%, .25) 15%, hsla(0, 0%, 100%, .8) 30%,
        hsla(0, 0%, 100%, .25) 45%, rgba(0, 0, 0, .6) 90%);
    margin-left: 3px;
    margin-top: -4px;
    transform-origin: left;
  }

  span.note {
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    width: 100%;
    height: 38px;
    z-index: 2;
  }

  span.noteFirstFret {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 38px;
    text-align: left;
    z-index: 2;

  }

  button.PlayButton {
    font-size: 25px;
    background-color: #c5a880;
    color: #0f0f0f;
    font-family: 'Gill Sans MT';
    margin-left: 10%;
    margin-right: auto;
    font-style: italic;
    text-align: center;
    margin-top: 20px;
  }

  button.StopButton {
    font-size: 25px;
    font-style: italic;
    font-family: 'Gill Sans MT';
    background-color: #c5a880;
    color: #0f0f0f;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
    margin-top: 20px;
  }

  button.RecordButton {
    font-size: 25px;
    font-style: italic;
    font-family: 'Gill Sans MT';
    background-color: #c5a880;
    margin-left: auto;
    margin-right: 10%;
    color: #0f0f0f;
    text-align: center;
    margin-top: 20px;
  }

  span.Record {
    background: red;
    border-radius: 50%;
    float: left;
    width: 30px;
    height: 30px;
    margin-right: 4px;
    margin-top: 3px;
  }

  span.Play {
    background: url("Images/PlayButton.png");
    background-size: cover;
    float: left;
    width: 30px;
    height: 30px;
    margin-right: 4px;
    margin-top: 3px;
  }

  span.Stop {
    background: url("Images/StopButton.png");
    background-size: cover;
    float: left;
    width: 30px;
    height: 30px;
    margin-right: 4px;
    margin-top: 3px;
  }

  h1 {
    color: #eeeeee;
    font-size: 50px;
    text-align: center;
  }

  .slider {
    -webkit-appearance: none;
    width: 100%;
    height: 15px;
    border-radius: 5px;
    background: #c5a880;
    margin-top: 20px;
    outline: none;
    -webkit-transition: .2s;
    transition: opacity .2s;
  }

  .slider::-webkit-slider-thumb {
    appearance: none;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    background: #eeeeee;
    cursor: pointer;
  }



  @media screen and (min-width: 900px) {

    div.GuitarBackground {
      width: 700px;
      height: 300px;
    }


    li.GuitarNeck-ul-li {
      width: 60px;
      height: 300px;
    }

    span.note {
      height: 55px;
    }

    li.firstFret-ul-li {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 48px;
      margin: 0;
      padding: 0;
      border: 0;
      color: #0f0f0f;
      font-size: 20px;
      font-style: italic;
      font-family: 'Gill Sans MT';
    }

    ul.Strings {
      width: 680px;
      height: 300px;
      padding-inline-start: 16px;
    }

    li.String-li {
      height: 50px;
    }

    button.PlayButton {
      font-size: 30px;
    }

    button.StopButton {
      font-size: 30px;
    }

    button.RecordButton {
      font-size: 30px;
    }

    span.Record {
      margin-right: 4px;
      margin-top: 6px;
    }

    span.Play {
      margin-right: 4px;
      margin-top: 6px;
    }

    span.Stop {
      margin-right: 4px;
      margin-top: 6px;
    }

    label.ComboBoxLabel {
      font-size: 30px;

    }

    select.ComboBox {
      font-size: 30px;

    }
  }
</style>

<body>
  <audio id="0" src="Sounds/0.wav" preload="auto"></audio>
  <audio id="1" src="Sounds/1.wav" preload="auto"></audio>
  <audio id="2" src="Sounds/2.wav" preload="auto"></audio>
  <audio id="3" src="Sounds/3.wav" preload="auto"></audio>
  <audio id="4" src="Sounds/4.wav" preload="auto"></audio>
  <audio id="5" src="Sounds/5.wav" preload="auto"></audio>
  <audio id="6" src="Sounds/6.wav" preload="auto"></audio>
  <audio id="7" src="Sounds/7.wav" preload="auto"></audio>
  <audio id="8" src="Sounds/8.wav" preload="auto"></audio>
  <audio id="9" src="Sounds/9.wav" preload="auto"></audio>
  <audio id="10" src="Sounds/10.wav" preload="auto"></audio>
  <audio id="11" src="Sounds/11.wav" preload="auto"></audio>
  <audio id="12" src="Sounds/12.wav" preload="auto"></audio>
  <audio id="13" src="Sounds/13.wav" preload="auto"></audio>
  <audio id="14" src="Sounds/14.wav" preload="auto"></audio>
  <audio id="15" src="Sounds/15.wav" preload="auto"></audio>
  <audio id="16" src="Sounds/16.wav" preload="auto"></audio>
  <audio id="17" src="Sounds/17.wav" preload="auto"></audio>
  <audio id="18" src="Sounds/18.wav" preload="auto"></audio>
  <audio id="19" src="Sounds/19.wav" preload="auto"></audio>
  <audio id="20" src="Sounds/20.wav" preload="auto"></audio>
  <audio id="21" src="Sounds/21.wav" preload="auto"></audio>
  <audio id="22" src="Sounds/22.wav" preload="auto"></audio>
  <audio id="23" src="Sounds/23.wav" preload="auto"></audio>
  <audio id="24" src="Sounds/24.wav" preload="auto"></audio>
  <audio id="25" src="Sounds/25.wav" preload="auto"></audio>
  <audio id="26" src="Sounds/26.wav" preload="auto"></audio>
  <audio id="27" src="Sounds/27.wav" preload="auto"></audio>
  <audio id="28" src="Sounds/28.wav" preload="auto"></audio>
  <audio id="29" src="Sounds/29.wav" preload="auto"></audio>
  <audio id="30" src="Sounds/30.wav" preload="auto"></audio>
  <audio id="31" src="Sounds/31.wav" preload="auto"></audio>
  <audio id="32" src="Sounds/32.wav" preload="auto"></audio>
  <audio id="33" src="Sounds/33.wav" preload="auto"></audio>
  <audio id="34" src="Sounds/34.wav" preload="auto"></audio>
  <audio id="35" src="Sounds/35.wav" preload="auto"></audio>
  <audio id="36" src="Sounds/36.wav" preload="auto"></audio>
  <audio id="37" src="Sounds/37.wav" preload="auto"></audio>
  <audio id="38" src="Sounds/38.wav" preload="auto"></audio>
  <audio id="39" src="Sounds/39.wav" preload="auto"></audio>
  <audio id="40" src="Sounds/40.wav" preload="auto"></audio>
  <audio id="41" src="Sounds/41.wav" preload="auto"></audio>
  <audio id="42" src="Sounds/42.wav" preload="auto"></audio>
  <audio id="43" src="Sounds/43.wav" preload="auto"></audio>
  <audio id="44" src="Sounds/44.wav" preload="auto"></audio>
  <audio id="45" src="Sounds/45.wav" preload="auto"></audio>
  <audio id="46" src="Sounds/46.wav" preload="auto"></audio>
  <audio id="47" src="Sounds/47.wav" preload="auto"></audio>
  <audio id="48" src="Sounds/48.wav" preload="auto"></audio>
  <audio id="49" src="Sounds/49.wav" preload="auto"></audio>
  <audio id="50" src="Sounds/50.wav" preload="auto"></audio>
  <audio id="51" src="Sounds/51.wav" preload="auto"></audio>
  <audio id="52" src="Sounds/52.wav" preload="auto"></audio>
  <audio id="53" src="Sounds/53.wav" preload="auto"></audio>
  <audio id="54" src="Sounds/54.wav" preload="auto"></audio>
  <audio id="55" src="Sounds/55.wav" preload="auto"></audio>
  <audio id="56" src="Sounds/56.wav" preload="auto"></audio>
  <audio id="57" src="Sounds/57.wav" preload="auto"></audio>
  <audio id="58" src="Sounds/58.wav" preload="auto"></audio>
  <audio id="59" src="Sounds/59.wav" preload="auto"></audio>
  <audio id="60" src="Sounds/60.wav" preload="auto"></audio>
  <audio id="61" src="Sounds/61.wav" preload="auto"></audio>
  <audio id="62" src="Sounds/62.wav" preload="auto"></audio>
  <audio id="63" src="Sounds/63.wav" preload="auto"></audio>
  <audio id="64" src="Sounds/64.wav" preload="auto"></audio>
  <audio id="65" src="Sounds/65.wav" preload="auto"></audio>



  <div class="Conteiner">
    <h1 id="sa">Virtual Guitar</h1>
    <div class="GuitarBackground">
      <ul class="guitarNeck">
        <li class="GuitarNeck-ul-li">
          <ul class="firstFret">
            <li class="firstFret-ul-li">E<span class="note">0</span> </li>
            <li class="firstFret-ul-li">B<span class="note">1</span> </li>
            <li class="firstFret-ul-li">G<span class="note">2</span> </li>
            <li class="firstFret-ul-li">D<span class="note">3</span> </li>
            <li class="firstFret-ul-li">A<span class="note">4</span> </li>
            <li class="firstFret-ul-li">E<span class="note">5</span> </li>
          </ul>
        </li>

        <li class="GuitarNeck-ul-li">
          <span class="note">6</span>
          <span class="note">7</span>
          <span class="note">8</span>
          <span class="note">9</span>
          <span class="note">10</span>
          <span class="note">11</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">12</span>
          <span class="note">13</span>
          <span class="note">14</span>
          <span class="note">15</span>
          <span class="note">16</span>
          <span class="note">17</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">18</span>
          <span class="note">19</span>
          <span class="note">20</span>
          <span class="note">21</span>
          <span class="note">22</span>
          <span class="note">23</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">24</span>
          <span class="note">25</span>
          <span class="note">26</span>
          <span class="note">27</span>
          <span class="note">28</span>
          <span class="note">29</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">30</span>
          <span class="note">31</span>
          <span class="note">32</span>
          <span class="note">33</span>
          <span class="note">34</span>
          <span class="note">35</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">36</span>
          <span class="note">37</span>
          <span class="note">38</span>
          <span class="note">39</span>
          <span class="note">40</span>
          <span class="note">41</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">42</span>
          <span class="note">43</span>
          <span class="note">44</span>
          <span class="note">45</span>
          <span class="note">46</span>
          <span class="note">47</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">48</span>
          <span class="note">49</span>
          <span class="note">50</span>
          <span class="note">51</span>
          <span class="note">52</span>
          <span class="note">53</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">54</span>
          <span class="note">55</span>
          <span class="note">56</span>
          <span class="note">57</span>
          <span class="note">58</span>
          <span class="note">59</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">60</span>
          <span class="note">61</span>
          <span class="note">62</span>
          <span class="note">63</span>
          <span class="note">64</span>
          <span class="note">65</span>
        </li>

        <ul class="Strings">
          <li class="String-li">
            <span id="s0" class="string"></span>
            <span id="sT0" class="stringTremble"></span>
          </li>
          <li class="String-li">
            <span id="s1" class="string"></span>
            <span id="sT1" class="stringTremble"></span>
          </li>
          <li class="String-li">
            <span id="s2" class="string"></span>
            <span id="sT2" class="stringTremble"></span>
          </li>
          <li class="String-li">
            <span id="s3" class="string"></span>
            <span id="sT3" class="stringTremble"></span>
          </li>
          <li class="String-li">
            <span id="s4" class="string"></span>
            <span id="sT4" class="stringTremble"></span>
          </li>
          <li class="String-li">
            <span id="s5" class="string"></span>
            <span id="sT5" class="stringTremble"></span>
          </li>
        </ul>
      </ul>


      <div class="ButtonsContainer">
        <button class="PlayButton" onclick="PlaySelectedSong()"><span class="Play"></span>Play</button>
        <button class="StopButton" onclick="StopSong()"><span class="Stop"></span>Stop</button>
        <button id="RecordButton" class="RecordButton" onclick="Record()"><span id="recordSpan" class="Record"></span>
          Record</button>
      </div>

      <div class="slidecontainer">
        <input type="range" min="1" max="100" value="50" class="slider" id="Slider">
      </div>

      <div class="ComboBoxContainer">
        <label class="ComboBoxLabel" for="songs"> Choose A Song : </label>
        <select class="ComboBox" id="songs">
          <option>Pirates Of The Caribbean</option>
          <option>Rohan Theme</option>
        </select>
      </div>


    </div>

  </div>
</body>

<script>

  //Our note class we need it because of Record and PlayRecord functions.
  class Note {
    constructor(note, ms) {
      this.note = note;
      this.ms = ms;
    }
  }

  // We need this class because of PlaySelectedSong function.
  class Song {
    constructor(songName, song) {
      this.songName = songName;
      this.song = song;
    }
  }


  var notes = [];
  var rotateList = [];

  //Fill list with notes at the beginning of the program.
  function fillNotesList() {
    for (let i = 0; i < 1; i++) {
      notes.push(document.getElementById(i));
    }
  }

  fillNotesList();

  //Fill tremble list with rotates at the beginning of the program.
  function fillRotateList() {
    var frequency = 1;
    for (let i = 0; i < 40; i++) {
      rotateList.push("rotate(" + frequency + "deg)");
      rotateList.push("rotate(-" + frequency + "deg)");
      frequency -= 0.024; // The rotate is running by decreasing.
    }
  }

  fillRotateList();

  var trembleList = { transform: rotateList };


  //When we press the string we call this function.
  function Play(note) {
    var audio = document.getElementById(note); //We get the audio by the given value. The value is between 0 to 77. all numbers define a note.
    audio.currentTime = 0; // If we press the same place we restart the audio
    audio.play();
    StringTremble(note); //And when we play sound we tremble the string.
  }

  function StringTremble(note) {
    var column = (note / 6);
    var row = note % 6;
    // We get our strings.
    var animatedString = document.getElementById("sT" + row);
    var realString = document.getElementById("s" + row);
    // Arrange their width according to the column that the user press.
    animatedString.style.width = 100 - Math.trunc(column) * 7 + "%";
    realString.style.width = Math.trunc(column) * 7 + "%";
    // move animatedString to the end of real string
    animatedString.style.marginLeft = Math.trunc(column) * 7 + ".4%";
    // tremble the string.
    animatedString.animate(trembleList, 2500);
  }


  //This function waits according to the given ms.
  function Wait(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // The list that we recording in to.
  var record = []
  // The list that hold records.
  var SongList = [];

  // Play the song according to the given song.
  async function PlaySong(song) {
    for (let i = 0; i < song.length; i++) {
      await Wait(song[i].ms);        // We wait according to ms of record
      if (song.length != 0 && stopSong == 0) {        // If the record is not empty
        SlideTheBar(song.length, i);
        Play(song[i].note);          // We play the note that recorded
        console.log(song[i].note, song[i].ms);
      }
      else {
        console.log("Record is empty or The StopSong worked")
        stopSong = 0;
        break;
      }
    }
  }

  var stopSong = 0;
  function StopSong() { // it doesnt work now.
    stopSong = 1; // We clear the array to stop playing.
  }


  var isRecording = 0;
  var time1;
  //When we press the record button this function called.
  function Record() {
    //This function just makes the global variable "isRecording" to 1 or 0 and global variable "time1" equals to dateNow.
    if (isRecording == 0) {
      record = [];
      time1 = Date.now();
      isRecording = 1;
      RecordAnimation();
    }
    else {
      //We add the record to the recordList and the comboBox with name that user give us.
      var selectTag = document.getElementById("songs");
      var option = document.createElement("option");
      var songName = prompt("Please Name Your Song");
      if (songName == null || songName == "") {
        songName = "Untitled";
      }
      option.text = songName;
      selectTag.add(option);
      song = new Song(songName, record);
      SongList.push(song);
      isRecording = 0
      RecordAnimation();
      selectTag.selectedIndex = selectTag.length - 1; // We choose the last added.
    }
    console.log(isRecording);
  }

  // When we press the play button this function called.
  function PlaySelectedSong() {
    var songs = document.getElementById("songs"); // We get comboBox
    var songName = songs.options[songs.selectedIndex].value; // We get the selected song's name.
    console.log(songName);
    for (let i = 0; i < SongList.length; i++) {
      if (SongList[i].songName == songName) {  // We find the song from the SongList
        PlaySong(SongList[i].song);  // And give it to the PlaySong Function.
      }
    }
  }

  // When we press the record this function calls.
  function RecordAnimation() {
    var recordSpan = document.getElementById("recordSpan");
    if (isRecording == 1) {  // until the record is finished the animation goes.
      colorList = ["red", "white", "red"];
      recordSpan.animate({ background: colorList }, { duration: 5000, iterations: Infinity });
    }
    else { // When it's finished we remove the span and we create it again due to finish the animation.
      recordSpan.remove();
      var x = document.createElement("SPAN");
      var recordButton = document.getElementById("RecordButton");
      x.setAttribute("id", "recordSpan");
      x.setAttribute("class", "Record");
      recordButton.appendChild(x);
    }
  }

  // We call this function in PlaySong.
  function SlideTheBar(max, current) {
    var slider = document.getElementById("Slider");
    slider.max = max;  // We set max value.
    slider.value = current + 1;  // And we move the slider.
  }

  window.onclick = e => {
    if (e.target.tagName == "SPAN") { //if we press a note that means a span
      console.log(e.target.innerText);
      Play(e.target.innerText);       // call the play function.
      if (isRecording == 1) {         // And if we are recording
        let time2 = Date.now();       //we take the time.
        console.log(time2 - time1);
        note = new Note(Number(e.target.innerText), time2 - time1); //We create a note with pressed note and time between 2 note.
        record.push(note);         // we add the note to the record list.
        time1 = Date.now();        // we update the global variable time1.
      }
    }
  }

</script>

</html>