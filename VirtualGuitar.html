<!doctype html>
<html>

<head>

  <title>GuitarPlayer</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="32x32"
    href="https://enesdurmus.github.io/GuitarPlayer/Images/VirtualGuitarIcon.png">
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>
  <script src="defaultSongs.js" defer></script>

</head>

<body>
  <audio id="0" src="Sounds/00.wav" preload="auto"></audio>
  <audio id="1" src="Sounds/01.wav" preload="auto"></audio>
  <audio id="2" src="Sounds/02.wav" preload="auto"></audio>
  <audio id="3" src="Sounds/03.wav" preload="auto"></audio>
  <audio id="4" src="Sounds/04.wav" preload="auto"></audio>
  <audio id="5" src="Sounds/05.wav" preload="auto"></audio>


  <div class="Conteiner">
    <h1 id="sa">Virtual Guitar</h1>
    <div class="GuitarBackground">
      <ul class="guitarNeck">
        <li class="GuitarNeck-ul-li">
          <ul class="firstFret">
            <li class="firstFret-ul-li">E<span class="note">0</span> </li>
            <li class="firstFret-ul-li">B<span class="note">1</span> </li>
            <li class="firstFret-ul-li">G<span class="note">2</span> </li>
            <li class="firstFret-ul-li">D<span class="note">3</span> </li>
            <li class="firstFret-ul-li">A<span class="note">4</span> </li>
            <li class="firstFret-ul-li">E<span class="note">5</span> </li>
          </ul>
        </li>

        <li class="GuitarNeck-ul-li">
          <span class="note">6</span>
          <span class="note">7</span>
          <span class="note">8</span>
          <span class="note">9</span>
          <span class="note">10</span>
          <span class="note">11</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">12</span>
          <span class="note">13</span>
          <span class="note">14</span>
          <span class="note">15</span>
          <span class="note">16</span>
          <span class="note">17</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">18</span>
          <span class="note">19</span>
          <span class="note">20</span>
          <span class="note">21</span>
          <span class="note">22</span>
          <span class="note">23</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">24</span>
          <span class="note">25</span>
          <span class="note">26</span>
          <span class="note">27</span>
          <span class="note">28</span>
          <span class="note">29</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">30</span>
          <span class="note">31</span>
          <span class="note">32</span>
          <span class="note">33</span>
          <span class="note">34</span>
          <span class="note">35</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">36</span>
          <span class="note">37</span>
          <span class="note">38</span>
          <span class="note">39</span>
          <span class="note">40</span>
          <span class="note">41</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">42</span>
          <span class="note">43</span>
          <span class="note">44</span>
          <span class="note">45</span>
          <span class="note">46</span>
          <span class="note">47</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">48</span>
          <span class="note">49</span>
          <span class="note">50</span>
          <span class="note">51</span>
          <span class="note">52</span>
          <span class="note">53</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">54</span>
          <span class="note">55</span>
          <span class="note">56</span>
          <span class="note">57</span>
          <span class="note">58</span>
          <span class="note">59</span>
        </li>
        <li class="GuitarNeck-ul-li">
          <span class="note">60</span>
          <span class="note">61</span>
          <span class="note">62</span>
          <span class="note">63</span>
          <span class="note">64</span>
          <span class="note">65</span>
        </li>

        <ul class="Strings">
          <li class="String-li">
            <span id="s0" class="string"></span>
            <span id="sT0" class="stringTremble"></span>
          </li>
          <li class="String-li">
            <span id="s1" class="string"></span>
            <span id="sT1" class="stringTremble"></span>
          </li>
          <li class="String-li">
            <span id="s2" class="string"></span>
            <span id="sT2" class="stringTremble"></span>
          </li>
          <li class="String-li">
            <span id="s3" class="string"></span>
            <span id="sT3" class="stringTremble"></span>
          </li>
          <li class="String-li">
            <span id="s4" class="string"></span>
            <span id="sT4" class="stringTremble"></span>
          </li>
          <li class="String-li">
            <span id="s5" class="string"></span>
            <span id="sT5" class="stringTremble"></span>
          </li>
        </ul>
      </ul>


      <div class="ButtonsContainer">
        <button class="PlayButton" onclick="PlaySelectedSong()"><span class="Play"></span>Play</button>
        <button class="StopButton" onclick="StopSong()"><span class="Stop"></span>Stop</button>
        <button id="RecordButton" class="RecordButton" onclick="Record()"><span id="recordSpan" class="Record"></span> Record</button>
      </div>

      <div class="ComboBoxContainer">
        <label class="ComboBoxLabel" for="songs"> Choose A Song : </label>
        <select class="ComboBox" id="songs">
          <option>Pirates Of The Caribbean</option>
          <option>Rohan Theme</option>
        </select>
      </div>
    </div>



  </div>
</body>

<script>

  //Our note class we need it because of Record and PlayRecord functions.
  class Note {
    constructor(note, ms) {
      this.note = note;
      this.ms = ms;
    }
  }

  // We need this class because of PlaySelectedSong function.
  class Song {
    constructor(songName, song) {
      this.songName = songName;
      this.song = song;
    }
  }


  var notes = [];
  var rotateList = [];

  //Fill list with notes at the beginning of the program.
  function fillNotesList() {
    for (let i = 0; i < 1; i++) {
      notes.push(document.getElementById(i));
    }
  }

  fillNotesList();

  //Fill tremble list with rotates at the beginning of the program.
  function fillRotateList() {
    var frequency = 1;
    for (let i = 0; i < 40; i++) {
      rotateList.push("rotate(" + frequency + "deg)");
      rotateList.push("rotate(-" + frequency + "deg)");
      frequency -= 0.024; // The rotate is running by decreasing.
    }
  }

  fillRotateList();

  var trembleList = { transform: rotateList };


  //When we press the string we call this function.
  function Play(note) {
    var audio = document.getElementById(note); //We get the audio by the given value. The value is between 0 to 77. all numbers define a note.
    audio.currentTime = 0; // If we press the same place we restart the audio
    audio.play();
    StringTremble(note); //And when we play sound we tremble the string.
  }

  function StringTremble(note) {
    var column = (note / 6);
    var row = note % 6;
    // We get our strings.
    var animatedString = document.getElementById("sT" + row);
    var realString = document.getElementById("s" + row);
    // Arrange their width according to the column that the user press.
    animatedString.style.width = 100 - Math.trunc(column) * 7 + "%";
    realString.style.width = Math.trunc(column) * 7 + "%";
    // move animatedString to the end of real string
    animatedString.style.marginLeft = Math.trunc(column) * 7 + ".8%";
    // tremble the string.
    animatedString.animate(trembleList, 2500);
  }


  //This function waits according to the given ms.
  function Wait(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // The list that we recording in to.
  var record = []
  // The list that hold records.
  var SongList = [];

  // Play the song according to the given song.
  async function PlaySong(song) {
    for (let i = 0; i < song.length; i++) {
      await Wait(song[i].ms);        // We wait according to ms of record
      if (song.length != 0 && stopSong == 0) {        // If the record is not empty
        Play(song[i].note);          // We play the note that recorded
        console.log(song[i].note, song[i].ms);
      }
      else {
        console.log("Record is empty or The StopSong worked")
        stopSong = 0;
        break;
      }
    }
  }

  var stopSong = 0;
  function StopSong() { // it doesnt work now.
    stopSong = 1; // We clear the array to stop playing.
  }


  var isRecording = 0;
  var time1;
  //When we press the record button this function called.
  function Record() {
    //This function just makes the global variable "isRecording" to 1 or 0 and global variable "time1" equals to dateNow.
    if (isRecording == 0) {
      record = [];
      time1 = Date.now();
      isRecording = 1;
      RecordAnimation();
    }
    else {
      //We add the record to the recordList and the comboBox with name that user give us.
      var selectTag = document.getElementById("songs");
      var option = document.createElement("option");
      var songName = prompt("Please Name Your Song");
      if (songName == null || songName == "") {
        songName = "Untitled";
      }
      option.text = songName;
      selectTag.add(option);
      song = new Song(songName, record);
      SongList.push(song);
      isRecording = 0
      RecordAnimation();
      selectTag.selectedIndex = selectTag.length - 1; // We choose the last added.
    }
    console.log(isRecording);
  }

  // When we press the play button this function called.
  function PlaySelectedSong() {
    var songs = document.getElementById("songs"); // We get comboBox
    var songName = songs.options[songs.selectedIndex].value; // We get the selected song's name.
    console.log(songName);
    for (let i = 0; i < SongList.length; i++) {
      if (SongList[i].songName == songName) {  // We find the song from the SongList
        PlaySong(SongList[i].song);  // And give it to the PlaySong Function.
      }
    }
  }

  // When we press the record this function calls.
  function RecordAnimation() {
    var recordSpan = document.getElementById("recordSpan");
    if (isRecording == 1) {  // until the record is finished the animation goes.
      colorList = ["red", "white", "red"];
     recordSpan.animate({ background: colorList }, {duration: 5000, iterations: Infinity});
    }
    else { // When it's finished we remove the span and we create it again due to finish the animation.
      recordSpan.remove();
      var x = document.createElement("SPAN");
      var recordButton = document.getElementById("RecordButton");
      x.setAttribute("id", "recordSpan");
      x.setAttribute("class", "Record");
      recordButton.appendChild(x);
    }
  }

  window.onclick = e => {
    if (e.target.tagName == "SPAN") { //if we press a note that means a span
      console.log(e.target.innerText);
      Play(e.target.innerText);       // call the play function.
      if (isRecording == 1) {         // And if we are recording
        let time2 = Date.now();       //we take the time.
        console.log(time2 - time1);
        note = new Note(Number(e.target.innerText), time2 - time1); //We create a note with pressed note and time between 2 note.
        record.push(note);         // we add the note to the record list.
        time1 = Date.now();        // we update the global variable time1.
      }
    }
  }
</script>

</html>